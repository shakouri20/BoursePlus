from math import log10
from matplotlib import pyplot as plt

from Infrastructure.Repository.TickerRepository import ticker_repo

HeavyBuysValue = [0.0, 0.3, 1.4, 3.7, 3.7, 3.7, 3.7, 3.7, 4.9, 5.8, 6.0, 6.0, 7.5, 7.7, 7.7, 7.7, 8.4, 9.1, 9.3, 10.1, 10.6, 10.6, 10.7, 10.8, 10.8, 11.9, 12.8, 13.1, 13.1, 13.4, 14.5, 15.1, 15.3, 15.8, 15.8, 16.5, 16.9, 16.9, 17.3, 17.3, 17.3, 17.6, 17.7, 17.7, 17.7, 18.4, 18.4, 18.4, 18.4, 18.6, 18.6, 18.6, 18.6, 18.5, 18.7, 18.7, 18.9, 21.2, 21.2, 21.3, 21.7, 25.8, 26.8, 26.8, 27.1, 27.6, 27.7, 27.9, 28.0, 28.1, 29.4, 29.4, 29.8, 29.9, 30.8, 40.9, 43.6, 44.7, 55.6, 61.0, 62.3, 62.5, 62.7, 63.0, 64.3, 65.0, 65.2, 66.4, 66.6, 66.6, 66.6, 66.7, 67.2, 69.4, 69.3, 69.4, 69.8, 71.2, 71.4, 74.1, 75.2, 75.6, 79.3, 81.1, 81.8, 82.2, 82.2, 82.5, 85.6, 85.6, 86.1, 86.2, 86.3, 87.1, 87.1, 87.8, 88.5, 88.5, 88.8, 89.3, 94.9, 95.0, 95.5, 95.4, 95.4, 95.6, 95.8, 96.0, 96.2, 96.2, 96.3, 96.4, 96.8, 96.8, 96.8, 97.0, 98.0, 99.1, 99.2, 99.4, 100.0, 101.4, 101.8, 102.1, 102.5, 102.5, 102.6, 103.2, 103.5, 103.6, 103.9, 103.9, 104.1, 104.5, 107.9, 108.7, 108.7, 108.7, 109.0, 109.2, 109.7, 109.8, 109.9, 110.1, 110.3, 110.2, 111.4, 111.6, 111.6, 112.0, 112.2, 112.2, 112.8, 112.7, 112.7, 113.4, 113.8, 114.6, 114.7, 115.4, 115.9, 116.0, 116.5, 117.2, 117.5, 117.6, 119.8, 120.9, 121.3, 121.4, 121.6, 122.4, 124.0, 124.2, 125.0, 125.0, 126.3, 126.8, 128.5, 130.4, 130.9, 132.7, 132.9, 134.1, 135.2, 135.2]
HeavySellsValue = [0.0, 0.0, 0.6, 1.5, 1.5, 1.9, 1.9, 1.9, 3.5, 4.2, 4.5, 5.6, 5.6, 5.8, 5.8, 5.8, 6.6, 7.5, 8.4, 8.9, 9.5, 9.5, 9.8, 10.1, 10.1, 10.1, 11.0, 12.3, 13.1, 13.3, 14.1, 14.4, 15.6, 15.7, 16.5, 16.6, 16.9, 17.5, 17.8, 17.8, 18.5, 20.1, 20.5, 21.4, 23.1, 23.9, 24.9, 25.0, 25.1, 25.1, 25.2, 25.5, 25.5, 25.5, 25.8, 26.3, 26.5, 28.7, 29.3, 29.4, 30.1, 30.0, 30.2, 31.4, 31.7, 32.7, 34.3, 35.0, 35.6, 35.6, 36.4, 36.9, 37.2, 37.2, 38.1, 38.4, 41.1, 42.1, 44.6, 45.7, 46.3, 46.5, 46.9, 47.2, 47.7, 48.6, 49.4, 50.9, 51.6, 52.1, 52.1, 52.7, 52.9, 55.1, 55.0, 55.1, 56.4, 57.0, 57.3, 57.7, 57.8, 57.8, 58.1, 58.7, 58.8, 59.5, 59.5, 60.7, 60.8, 60.8, 61.0, 62.5, 62.7, 63.4, 63.4, 63.9, 63.9, 64.1, 65.0, 66.3, 70.9, 70.9, 71.1, 71.2, 71.5, 71.9, 72.0, 72.3, 72.5, 72.9, 73.5, 73.5, 74.3, 74.8, 74.9, 75.0, 75.0, 75.9, 76.0, 76.3, 77.7, 81.6, 82.3, 82.9, 82.9, 84.8, 84.9, 85.7, 85.8, 86.1, 86.0, 86.2, 86.4, 86.8, 86.8, 87.1, 87.1, 87.6, 88.1, 88.6, 89.3, 89.6, 89.7, 96.7, 97.0, 97.0, 97.7, 97.9, 102.4, 103.3, 104.9, 105.0, 107.6, 107.7, 109.5, 111.7, 112.3, 112.3, 112.9, 114.6, 114.8, 115.3, 116.3, 117.0, 117.5, 118.1, 121.0, 122.6, 124.4, 126.9, 130.2, 130.4, 130.8, 131.6, 131.9, 134.0, 136.0, 137.0, 138.1, 138.7, 138.8, 140.8, 141.4, 142.1, 143.7, 143.7]
prc = [0.0, 0.3, 0.2, 0.4, 0.3, 0.2, 0.2, 0.2, 0.0, -2.0, -0.3, -0.2, -0.0, -0.1, -0.1, -0.1, -0.2, -0.3, -0.4, -0.5, -0.6, -0.6, -0.4, -0.6, -0.6, -0.3, -0.4, -0.5, -0.7, -0.7, -0.6, -0.6, -0.7, -0.7, -0.8, -0.8, -0.8, -0.8, -0.9, -0.8, -0.9, -1.0, -0.9, -0.9, -1.0, -1.0, -1.1, -1.2, -1.2, -1.1, -1.1, -1.1, -1.1, -1.1, -1.2, -1.2, -1.5, -1.2, -1.4, -1.4, -1.4, -1.1, -0.9, -1.0, -1.1, -1.0, -1.1, -1.2, -1.2, -1.2, -1.0, -1.1, -1.2, -1.1, -1.2, -1.1, -1.1, -1.1, -1.1, -0.9, -1.0, -1.0, -1.1, -1.1, -1.1, -1.2, -1.1, -1.1, -1.2, -1.2, -1.2, -1.2, -1.1, -1.1, -1.1, -1.1, -1.2, -1.0, -1.0, -0.9, -0.9, -0.8, -0.7, -0.5, -0.5, -0.5, -0.5, -0.5, -0.4, -0.4, -0.4, -0.5, -0.5, -0.5, -0.5, -0.5, -0.4, -0.5, -0.6, -0.5, -0.4, -0.3, -0.3, -0.4, -0.4, -0.4, -0.4, -0.5, -0.4, -0.5, -0.5, -0.5, -0.5, -0.6, -0.6, -0.6, -0.5, -0.5, -0.5, -0.5, -0.5, -0.7, -0.9, -0.9, -0.8, -0.9, -0.9, -0.9, -0.9, -1.1, -1.0, -1.2, -1.3, -1.1, -1.1, -1.1, -1.1, -1.1, -1.2, -1.2, -1.2, -1.2, -1.2, -1.4, -1.4, -1.4, -1.3, -1.4, -1.4, -1.5, -1.5, -1.6, -1.7, -1.7, -1.8, -1.9, -1.8, -1.8, -1.8, -1.8, -1.7, -1.8, -1.8, -1.8, -1.8, -1.8, -1.8, -1.9, -2.0, -2.1, -2.1, -2.1, -2.1, -2.2, -2.2, -2.2, -2.3, -2.3, -2.2, -2.1, -2.1, -1.9, -1.8, -1.8, -1.8, -1.8]
index = [-0.1, -0.08, -0.08, -0.03, -0.13, 0.03, 0.03, 0.02, -0.07, -0.07, 0.06, 0.14, 0.12, 0.19, 0.19, 0.19, 0.29, 0.35, 0.37, 0.41, 0.47, 0.47, 0.46, 0.48, 0.48, 0.5, 0.51, 0.51, 0.52, 0.5, 0.48, 0.48, 0.46, 0.46, 0.47, 0.48, 0.49, 0.47, 0.45, 0.46, 0.47, 0.48, 0.48, 0.49, 0.46, 0.45, 0.45, 0.4, 0.38, 0.37, 0.35, 0.33, 0.31, 0.28, 0.31, 0.29, 0.29, 0.33, 0.33, 0.34, 0.38, 0.36, 0.37, 0.36, 0.37, 0.37, 0.34, 0.33, 0.29, 0.3, 0.3, 0.31, 0.29, 0.3, 0.3, 0.28, 0.27, 0.27, 0.25, 0.29, 0.25, 0.26, 0.26, 0.25, 0.26, 0.25, 0.26, 0.24, 0.24, 0.24, 0.24, 0.26, 0.27, 0.3, 0.28, 0.29, 0.3, 0.3, 0.3, 0.32, 0.32, 0.35, 0.36, 0.36, 0.35, 0.38, 0.38, 0.39, 0.45, 0.44, 0.43, 0.48, 0.48, 0.51, 0.5, 0.53, 0.54, 0.55, 0.55, 0.53, 0.53, 0.52, 0.51, 0.51, 0.51, 0.51, 0.47, 0.45, 0.45, 0.43, 0.42, 0.44, 0.44, 0.45, 0.45, 0.46, 0.45, 0.45, 0.45, 0.49, 0.49, 0.45, 0.46, 0.48, 0.47, 0.48, 0.46, 0.46, 0.48, 0.49, 0.5, 0.49, 0.49, 0.5, 0.52, 0.5, 0.5, 0.48, 0.48, 0.46, 0.45, 0.46, 0.47, 0.47, 0.46, 0.46, 0.46, 0.45, 0.46, 0.45, 0.44, 0.43, 0.43, 0.43, 0.4, 0.39, 0.37, 0.38, 0.38, 0.36, 0.36, 0.36, 0.34, 0.32, 0.33, 0.32, 0.32, 0.33, 0.33, 0.3, 0.3, 0.31, 0.32, 0.29, 0.28, 0.27, 0.23, 0.22, 0.23, 0.25, 0.26, 0.29, 0.31, 0.35, 0.34, 0.34]
RealPowerHamvaznDif = [1.0, 1.01, 1.0, 0.96, 0.98, 0.92, 0.92, 0.92, 0.91, 0.9, 0.89, 0.9, 0.89, 0.88, 0.88, 0.88, 0.88, 0.91, 0.91, 0.92, 0.92, 0.92, 0.91, 0.91, 0.91, 0.91, 0.91, 0.89, 0.89, 0.9, 0.91, 0.91, 0.91, 0.92, 0.91, 0.91, 0.91, 0.9, 0.89, 0.89, 0.89, 0.9, 0.9, 0.9, 0.89, 0.89, 0.88, 0.88, 0.88, 0.89, 0.88, 0.88, 0.88, 0.88, 0.89, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.87, 0.87, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.88, 0.87, 0.87, 0.87, 0.88, 0.88, 0.88, 0.89, 0.88, 0.88, 0.88, 0.89, 0.89, 0.89, 0.89, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.91, 0.91, 0.91, 0.92, 0.92, 0.92, 0.92, 0.92, 0.93, 0.93, 0.92, 0.92, 0.92, 0.92, 0.92, 0.93, 0.93, 0.94, 0.94, 0.94, 0.95, 0.94, 0.95, 0.94, 0.94, 0.93, 0.93, 0.93, 0.93, 0.93, 0.93, 0.93, 0.94, 0.93, 0.93, 0.93, 0.94, 0.94, 0.94, 0.94, 0.94, 0.93, 0.92, 0.92, 0.93, 0.93, 0.93, 0.93, 0.94, 0.94, 0.94, 0.92, 0.92, 0.93, 0.93, 0.92, 0.92, 0.91, 0.92, 0.92, 0.92, 0.91, 0.92, 0.91, 0.91, 0.91, 0.91, 0.9, 0.91, 0.91, 0.91, 0.9, 0.91, 0.9, 0.89, 0.88, 0.89, 0.87, 0.88, 0.88, 0.87, 0.88, 0.87, 0.87, 0.87, 0.87, 0.87, 0.85, 0.85, 0.85, 0.85, 0.85, 0.85, 0.84, 0.84, 0.83, 0.82, 0.82, 0.83, 0.83, 0.83, 0.83, 0.83, 0.83, 0.82, 0.82]

fig, ax = plt.subplots(2, 2)
labelSize = 6

ax[0][0].plot(index, label= 'Present Index')
ax[0][0].legend(prop={'size': labelSize})

heavyDealsValue = [HeavyBuysValue[i]-HeavySellsValue[i] for i in range(len(HeavyBuysValue))]
clrs = ['red' if (x < 0) else 'green' for x in heavyDealsValue]
ax[1][0].bar(list(range(len(heavyDealsValue))), heavyDealsValue, color= clrs, label= 'Smart Money')
ax[1][0].legend(prop={'size': labelSize})

realPowerDif = [log10(item) for item in RealPowerHamvaznDif]
clrs = ['red' if (x < 0) else 'green' for x in realPowerDif]
ax[1][1].bar(list(range(len(heavyDealsValue))), realPowerDif, color= clrs, label= 'Real Power')
ax[1][1].legend(prop={'size': labelSize})
ax[1][1].axhline(log10(1.5))
ax[1][1].axhline(-log10(1.5))

ax2 = ax[1][1].twinx()
ax2.plot(prc, label= 'SmartMoney Percentage')
prcMax = max(prc)
prcMin = min(prc)
ax2.set_ylim([-1.2*max(abs(prcMin), abs(prcMax)), 1.2*max(abs(prcMin), abs(prcMax))])
ax2.legend(loc= "upper left", prop={'size': labelSize})

for i in range(2):
    for j in range(2):
        ax[i][j].grid(linestyle = '--', linewidth = 0.5)
        ax[i][j].spines['bottom'].set_color('white')
        ax[i][j].spines['top'].set_color('white') 
        ax[i][j].spines['right'].set_color('white')
        ax[i][j].spines['left'].set_color('white')
ax2.grid(linestyle = '--', linewidth = 0.5)
ax2.spines['bottom'].set_color('white')
ax2.spines['top'].set_color('white') 
ax2.spines['right'].set_color('white')
ax2.spines['left'].set_color('white')

plt.show()

ticker_repo().read_list_of_tickers()